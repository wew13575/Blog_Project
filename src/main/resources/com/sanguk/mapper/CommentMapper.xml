<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sanguk.mapper.CommentMapper">

    <resultMap id="commentMap" type="com.sanguk.domain.CommentVO">
        <result property="id" column="commentid" />
        <result property="author" column="commentauthor" />
        <result property="content" column="commentcontent" />
        <result property="regDate" column="commentregdate" />
        <association property="uservo" resultMap="cauthorMap"></association>
    </resultMap>

    <resultMap id="cauthorMap" type="com.sanguk.domain.UserVO">
        <result property="profilePath" column="profilepath" />
        <result property="userName" column="username" />
    </resultMap>

	<select id="getCommentList" resultMap ="commentMap">
		SELECT 
			c.commentid, c.commentauthor, c.commentcontent, c.commentregdate, u.profilepath, u.username
		FROM 
			comments c
			INNER JOIN users u ON c.commentauthor = u.userid
		WHERE c.articleid = #{articleid}
	</select>


    <select id="getComment" resultMap ="commentMap">
		SELECT 
			c.commentid, c.commentauthor, c.commentcontent, c.commentregdate, u.profilepath, u.username
		FROM 
			comments c
			INNER JOIN users u ON c.commentauthor = u.userid
		WHERE c.commentid = #{commentid}
	</select>

    <insert id="registerComment"  useGeneratedKeys="true" keyProperty="id" >
		INSERT INTO COMMENTS
		 	(articleid, commentauthor, commentcontent)
		values
			(#{articleid} ,#{author},#{content})
    </insert>

    <delete id="deleteComment">
        DELETE 
        FROM COMMENTS
        WHERE 
            commentid = #{commentId}
    </delete>

		










</mapper>