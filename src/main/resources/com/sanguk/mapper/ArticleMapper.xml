<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sanguk.mapper.ArticleMapper">
    <resultMap type="com.sanguk.domain.ArticleVO" id="articleMap">
        <id property="id" column="id" />
        <result property="author" column="author" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="viewcnt" column="viewcnt" />
        <result property="Thumnailpath" column="thumnailpath" />
        <result property="boardType" column="boardtype" />
        <result property="regDate" column="regdate" />
        <result property="updateDate" column="updateDate" />
        <association property="uservo" resultMap="authorMap"></association>
        <collection property="taglist" resultMap="tagMap"></collection>
    </resultMap>
    <resultMap id="tagMap" type="com.sanguk.domain.TagVO">
        <result property="tag" column="tag" />
    </resultMap>
    <resultMap id="authorMap" type="com.sanguk.domain.UserVO">
        <result property="profilePath" column="profilepath" />
        <result property="userinfo" column="userinfo" />
        <result property="userName" column="username" />
    </resultMap>

    <insert id="registerArticle" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO ARTICLES
		 	(author, title, content, thumnailpath, boardtype)
		values
			(#{author},#{title},#{content},#{Thumnailpath},#{boardType})
    </insert>
    <update id="setInfo">
		UPDATE ARTICLES
        SET title=#{title},content=#{content}
        WHERE boardType=2
    </update>

    <update id="updateArticle">
		UPDATE 
            ARTICLES
        SET title=#{title},content=#{content},thumnailpath=#{thumnailpath},updatedate = CURRENT_TIMESTAMP
        WHERE id=#{id}
    </update>

    <delete id="deleteArticle">
        DELETE 
        FROM
            ARTICLES
        WHERE 
            id=#{articleid}
    </delete>

    <select id="getArticle" resultMap="articleMap">
        SELECT 
            a.id, a.author, a.title, a.content, a.updatedate, t.tag, u.userinfo, u.profilepath, u.username
        FROM 
            articles a 
	    INNER JOIN users u on a.author = u.userid
	    LEFT OUTER JOIN tags t on a.id = t.articleid
        WHERE a.id = #{articleid}
    </select>
</mapper>